---

title: 代理爬虫

keywords: fastai
sidebar: home_sidebar

summary: "很多网站都有反爬虫机制，一个IP频繁访问一个网站，就会出现访问被拒绝的情况，所以换IP可以解决这个问题。（运用技术请克制，避免过度浪费服务器资源）"
description: "很多网站都有反爬虫机制，一个IP频繁访问一个网站，就会出现访问被拒绝的情况，所以换IP可以解决这个问题。（运用技术请克制，避免过度浪费服务器资源）"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 11_Proxy_Request.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    {% raw %}
        
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">reload_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="TODO">TODO<a class="anchor-link" href="#TODO"> </a></h1><ul>
<li>[x] 2020-03-15 抽象成Class</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#27979;&#35797;&#20195;&#29702;">&#27979;&#35797;&#20195;&#29702;<a class="anchor-link" href="#&#27979;&#35797;&#20195;&#29702;"> </a></h2><blockquote><p>有专用的付费代理IP稳定可靠，也有免费的代理IP可能会随时失效</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>先从 <a href="https://www.freeip.top/">https://www.freeip.top/</a> 随便拿个ip来测试</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#21046;&#20316;&#20195;&#29702;&#27744;">&#21046;&#20316;&#20195;&#29702;&#27744;<a class="anchor-link" href="#&#21046;&#20316;&#20195;&#29702;&#27744;"> </a></h2><blockquote><p>网上有专门整理的<a href="https: //github.com/jhao104/proxy_pool">代理池</a>，但需要配置数据库，所以不在这里演示，而是自己写个爬虫，通过<a href="https://github.com/jiangxianli/ProxyIpLib">这个网站的API</a>获取IP</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Proxy" class="doc_header"><code>class</code> <code>Proxy</code><a href="https://github.com/neo4dev/crawler_from_scratch/tree/master/crawler_from_scratch/proxy.py#L16" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Proxy</code>()</p>
</blockquote>
<p>一个代理器，用爬取的免费代理ip，来爬取网站</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#33258;&#21160;&#20999;&#25442;&#20195;&#29702;">&#33258;&#21160;&#20999;&#25442;&#20195;&#29702;<a class="anchor-link" href="#&#33258;&#21160;&#20999;&#25442;&#20195;&#29702;"> </a></h2><blockquote><p>优先选择健康值高的ip，一次请求，成功健康值+1，失败则减半</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#26657;&#39564;&amp;&#26356;&#26367;&#20195;&#29702;">&#26657;&#39564;&amp;&#26356;&#26367;&#20195;&#29702;<a class="anchor-link" href="#&#26657;&#39564;&amp;&#26356;&#26367;&#20195;&#29702;"> </a></h2><blockquote><p>用百度批量测试网站的有效性</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#29992;&#20195;&#29702;&#29228;&#21462;&#35910;&#29923;&#39029;&#38754;">&#29992;&#20195;&#29702;&#29228;&#21462;&#35910;&#29923;&#39029;&#38754;<a class="anchor-link" href="#&#29992;&#20195;&#29702;&#29228;&#21462;&#35910;&#29923;&#39029;&#38754;"> </a></h2><blockquote><p>昨天用豆瓣页面测试爬虫功能的时候，就发现了访问频率过高的被拒的问题，今天就用爬虫来抓取整个互联网类目下的图书信息</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">url_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;https://book.douban.com/tag/</span><span class="si">%E</span><span class="s1">4%BA</span><span class="si">%92%</span><span class="s1">E8</span><span class="si">%81%</span><span class="s1">94</span><span class="si">%E</span><span class="s1">7%BD%91?start=</span><span class="si">{i}</span><span class="s1">&amp;type=T&#39;</span>
    <span class="n">url_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">url_list</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>50</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_douban_data</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">px</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>    

    <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">main_content</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">,</span><span class="n">class_</span><span class="o">=</span><span class="s1">&#39;subject-list&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">get_children</span><span class="p">(</span><span class="n">main_content</span><span class="p">):</span>
            <span class="n">item_data</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">a_nbg_url</span> <span class="o">=</span> <span class="n">item_data</span><span class="p">[</span><span class="s1">&#39;a_nbg_url&#39;</span><span class="p">]</span>
            <span class="n">_id</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;/(\d+)/&#39;</span><span class="p">,</span><span class="n">a_nbg_url</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># 写入data</span>
            <span class="n">data</span><span class="p">[</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">item_data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>得到了这样的规范的数据结构的数据，就可以进行很多数据分析的工作，比如评价数分布，评分分布，热门作者等等</p>

</div>
</div>
</div>
    {% endraw %}
</div>
 

